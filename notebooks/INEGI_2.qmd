---
title: "SituacionProblema1.1"
author: Joshua Chaidez
format:
   html:
     toc: true
     html-math-method: katex
     embed-resources: true
     self-contained-math: true
     df-print: kable
editor: visual
---

# Situacion Problema

### En base a la infomacion proporcionada por la Encuesta Origen Destino en Hogares de la Zona Metropolitana del Valle de México (EOD) 2017, se deben proporcionar respuestas a las siguientes Queries, usando el metodo de las redes DAG.

1.  ¿Cuál es la probabilidad de que el tiempo de viaje sea menor a 20 minutos, dado que su medio de transporte fue el automóvil?
2.  ¿Cuál es la probabilidad de que los viajes en Ciudad de México se hagan en medios no motorizados (caminar o bicicleta)?
3.  ¿Cuál es la probabilidad de que un hogar de estrato medio bajo, utilicen más de 2 medios de transporte diferentes?
4.  ¿Cuál es la probabilidad de que el viaje del hogar a la escuela dure más de 60 minutos si la persona viaja en coche?

Datos necesarios: - Tiempos de viaje por medio de transporte - Viajes en la ciudad de México por medio de transporte (motorizado/no motorizado) - \# de medios de transporte por estratro de hogar - Tiempos de viaje de hogar a escuela por transporte

Relaciones de los datos: Viajes / Medio de transporte (1,2) Estrato hogar / \# de medios de transporte Tiempo de viaje / Origen / Destino

```{r}
library(bnlearn)
```

```{r}
data = read.csv("../data/tviaje_clean.csv", stringsAsFactors = TRUE)
#head(data)
```

```{r}
# Columnas discretas (todas excepto tiempo)
disc_cols <- c("auto","colectivo","uber_etc","taxi","metro","bici","moto","caminar",
               "entidad_origen","entidad_destino","tipo_origen","tipo_destino",
               "estrato","tiempo")

# Continua
#cont_cols <- c("tiempo")

# 1) Convertir discretas a factor
data[disc_cols] <- lapply(data[disc_cols], factor)

```

```{r}
head(data["tiempo"])
```

```{r}
summary(data["tiempo"])
```

```{r}
head(data)
```

```{r}
# estructura DAGs planteadas

a = c(
  "moto", "tiempo",
  "estrato", "tiempo",
  "taxi", "tiempo",
  "auto", "tiempo",
  "entidad_origen", "tiempo",
  "entidad_destino", "tiempo",
  "caminar", "moto",
  "metro", "tipo_destino",
  "entidad_destino", "tipo_destino",
  "entidad_destino", "metro",
  "tipo_origen", "colectivo",
  "entidad_origen", "tipo_destino",
  "uber_etc", "taxi",
  "auto", "estrato"
)

b = c(
  "entidad_origen", "colectivo",
  "entidad_destino", "colectivo",
  "tipo_origen", "colectivo",
  "tipo_origen", "metro",
  "entidad_destino", "caminar",
  "entidad_origen", "caminar",
  "estrato", "entidad_origen",
  "entidad_destino", "uber_etc",
  "estrato", "uber_etc",
  "entidad_origen", "uber_etc",
  "bici", "tipo_destino",
  "entidad_origen", "tiempo",
  "auto", "tiempo",
  "moto", "tiempo",
  "entidad_destino", "tiempo",
  "uber_etc", "tiempo",
  "metro", "tiempo",
  "entidad_destino", "bici",
  "estrato", "auto",
  "estrato", "moto",
  "entidad_destino", "taxi",
  "estrato", "taxi"
)

c = c(
  "entidad_destino", "colectivo",
  "entidad_origen", "colectivo",
  "auto", "tiempo",
  "taxi", "tiempo",
  "metro", "tiempo",
  "moto", "tiempo",
  "uber_etc", "taxi",
  "metro", "taxi",
  "caminar", "metro",
  "entidad_destino", "tipo_destino",
  "entidad_origen", "bici",
  "entidad_origen", "moto",
  "estrato", "moto",
  "estrato", "auto",
  "estrato", "tipo_origen",
  "entidad_origen", "tipo_origen"
)
```

```{r}
arc_set_a <- matrix(a, byrow = TRUE, ncol = 2, dimnames = list(NULL, c("from", "to")))
arc_set_b <- matrix(b, byrow = TRUE, ncol = 2, dimnames = list(NULL, c("from", "to")))
arc_set_c <- matrix(c, byrow = TRUE, ncol = 2, dimnames = list(NULL, c("from", "to")))
```

```{r}
dag_a = empty.graph(nodes = c(disc_cols))
dag_b = dag_a
dag_c = dag_a
```

```{r}
arcs(dag_a) <- arc_set_a
arcs(dag_b) <- arc_set_b
arcs(dag_c) <- arc_set_c
```

```{r}
graphviz.plot(dag_a, shape = "ellipse")
```

```{r}
graphviz.plot(dag_b, shape = "ellipse")
```

```{r}
graphviz.plot(dag_c, shape = "ellipse")
```

```{r}
# DAG mixta (discretas + continuas): BIC-CG
dag <- hc(data, score = "bic")
dag
```

```{r}
graphviz.plot(dag, shape = "ellipse")
```

```{r}
scores <- c(
  dag_a = score(dag_a, data = data, type = "bic"),
  dag_b = score(dag_b, data = data, type = "bic"),
  dag_c = score(dag_c, data = data, type = "bic"),
  dag = score(dag, data = data, type = "bic")
)

scores
```

```{r}
scores <- c(
  dag_a = score(dag_a, data = data, type = "aic"),
  dag_b = score(dag_b, data = data, type = "aic"),
  dag_c = score(dag_c, data = data, type = "aic"),
  dag = score(dag, data = data, type = "aic")
)

scores
```

```{r}
bn <- bn.fit(dag, data = data)
```

1.  ¿Cuál es la probabilidad de que el tiempo de viaje sea menor a 20 minutos, dado que su medio de transporte fue el automóvil?

```{r}
set.seed(1809)
cpquery(bn, event = (tiempo == "(0.999, 10.0]" | tiempo == "(10.0, 15.0]" | tiempo == "(15.0, 20.0]"), evidence = (auto == 1), n = 10^6)
```

2.  ¿Cuál es la probabilidad de que los viajes en Ciudad de México se hagan en medios no motorizados (caminar o bicicleta)?

caminar= 1 (verdadero) bici= 1 (verdadero)

entidad_origen = 9 (CDMX) entidad_destino= 9 (CDMX)

```{r}
set.seed(1809)
cpquery(bn, event = (caminar == 1 | bici == 1), evidence = (entidad_origen == 9 & entidad_destino == 9), n = 10^6)

```

3.  ¿Cuál es la probabilidad de que un hogar de estrato medio bajo, utilicen más de 2 medios de transporte diferentes?

```{r}
set.seed(1809)
cpquery(bn, event = ((auto==1) + (colectivo==1) + (uber_etc==1) + (taxi==1) + (metro==1) + (bici==1) + (moto==1) + (caminar==1)) >= 3,
        evidence = (estrato == 2), n = 10^6
)
```

4.  ¿Cuál es la probabilidad de que el viaje del hogar a la escuela dure más de 60 minutos si la persona viaja en coche?

    tipo_origen== 1 (Hogar) tipo_destino == 2 (Escuela)

coche == 1 (verdadero)

```{r}
set.seed(1809)
cpquery(bn, event = (tiempo == "(69.0, 95.0]" | tiempo == "(other)"), evidence = (tipo_origen == 1 & tipo_destino == 2 & auto == 1), n = 10^6)
```
